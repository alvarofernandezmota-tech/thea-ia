# =======================================================
# THEA IA 3.0 – ENTORNO DE CONFIGURACIÓN ENTERPRISE
# =======================================================

# === Entorno general ===
APP_NAME=Thea IA
APP_VERSION=3.0.0
ENVIRONMENT=production
DEBUG=false
LOG_LEVEL=INFO

# === API & Servidor ===
API_HOST=0.0.0.0
API_PORT=8000
API_PREFIX=/api/v1
SECRET_KEY=change_this_in_production_please
JWT_ALGORITHM=HS256
JWT_EXPIRE_HOURS=24

# === Base de datos principal (PostgreSQL) ===
DATABASE_URL=postgresql+asyncpg://thea_user:thea_password@db.theaia.internal:5432/theaia_db
DATABASE_POOL_SIZE=10
DATABASE_TIMEOUT=30

# === Base de datos fallback (SQLite) ===
SQLITE_URL=sqlite+aiosqlite:///local.db

# === Cache y Mensajería (Redis / Celery) ===
REDIS_HOST=redis.theaia.internal
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=0
REDIS_URI=redis://redis.theaia.internal:6379/0

# === Machine Learning / NLP ===
SPACY_MODEL=es_core_news_md
ML_INTENT_MODEL_PATH=models/intent_classifier_v3.pkl
ML_ENTITY_MODEL_PATH=models/entity_extractor_v3.pkl
ML_CONFIDENCE_THRESHOLD=0.82

# === Integraciones de Bots ===
TELEGRAM_BOT_TOKEN=your_bot_token_here
TELEGRAM_WEBHOOK_URL=https://api.theaia.com/webhook/telegram
TELEGRAM_WEBHOOK_SECRET=replace_with_webhook_secret
ENABLED_ADAPTERS=telegram,rest

# === Logging & Métricas ===
LOG_FILE_PATH=logs/theaia.log
LOG_MAX_SIZE_MB=20
LOG_BACKUP_COUNT=7
LOG_JSON_FORMAT=true
METRICS_ENABLED=true
PROMETHEUS_ENDPOINT=/metrics
HEALTHCHECK_ENDPOINT=/health
HEALTH_CHECK_INTERVAL=30

# === Autenticación Cloud & Seguridad ===
CORS_ALLOWED_ORIGINS=https://app.theaia.com,https://admin.theaia.com
ALLOWED_HOSTS=localhost,127.0.0.1,app.theaia.com
CSRF_PROTECTION=true

# === CI/CD y Deploy ===
RAILWAY_TOKEN=your_railway_token_here
DOCKER_REGISTRY=registry.theaia.com
IMAGE_NAME=thea-ia
IMAGE_TAG=latest
DOCKERFILE_PATH=./Dockerfile.optimized

# === Monitoreo Empresarial (Prometheus, Grafana, Loki) ===
GRAFANA_DASHBOARD_URL=https://grafana.theaia.com
PROMETHEUS_TARGET_URL=http://prometheus.theaia.internal:9090
LOKI_LOG_SERVER=http://loki.theaia.internal:3100
ENABLE_ALERTS=true

# === Backups y Auditoría ===
BACKUP_PATH=/var/backups/theaia/
BACKUP_CRON=0 2 * * *
ENABLE_DATA_AUDIT=true
AUDIT_RETENTION_DAYS=90

# === Email corporativo / Notificaciones ===
SMTP_SERVER=smtp.theaia.com
SMTP_PORT=587
SMTP_USER=notifications@theaia.com
SMTP_PASSWORD=secure_password_here
SYSTEM_EMAIL=system@theaia.com

# =======================================================
# FIN DEL ARCHIVO DE CONFIGURACIÓN THEA IA 3.0
# =======================================================
# =======================================================
# THEA IA 2.0 — CONFIGURACIÓN ENTERPRISE Y AUDITORÍA
# =======================================================
# Archivo de configuración por entorno (desarrollo, staging, producción).
# 
# FILOSOFÍA:
# - Cada variable documentada y asociada a su módulo/hito.
# - Estructura modular y por carpetas (core, agents, adapters, ml, tests, docs).
# - Trazabilidad y auditoría por entorno y feature.
# - Seguridad: NUNCA subas .env al repositorio (protegido en .gitignore).
#
# Actualizado: 2025-10-31
# Autor: Álvaro Fernández Mota (CEO THEA IA)
# Versión: 2.0 / v0.14.0
# =======================================================

# -------------------------------------------------------
# 1. ENTORNO Y DEBUG GENERAL
# -------------------------------------------------------
APP_NAME=Thea IA
APP_VERSION=2.0.0
ENVIRONMENT=development               # development, staging, production
DEBUG=false                           # true/false para logs verbosos
LOG_LEVEL=INFO                        # DEBUG, INFO, WARNING, ERROR, CRITICAL
LOG_FORMAT=json                       # json o text para output logs


# -------------------------------------------------------
# 2. API Y SERVIDOR (CORE/ROUTER)
# -------------------------------------------------------
# Hito H01: Organización, compatibilidad de tests y core.
# Hito H03: FSM orquestación y manager universal.
API_HOST=0.0.0.0
API_PORT=8000
API_PREFIX=/api/v1
API_TIMEOUT_SECONDS=30
SECRET_KEY=change_this_in_production_please_32chars_min
JWT_ALGORITHM=HS256
JWT_EXPIRE_HOURS=24
JWT_REFRESH_EXPIRE_DAYS=7


# -------------------------------------------------------
# 3. BASE DE DATOS PRIMARIA (PostgreSQL / Production)
# -------------------------------------------------------
# Hito H04: Persistencia, base de datos y auditoría avanzada.
DATABASE_TYPE=postgresql              # postgresql, sqlite, mysql
DATABASE_URL=postgresql+asyncpg://thea_user:thea_password@db.theaia.internal:5432/theaia_db
DATABASE_POOL_SIZE=10
DATABASE_POOL_OVERFLOW=20
DATABASE_TIMEOUT=30
DATABASE_ECHO=false                   # true en debug, false en prod


# -------------------------------------------------------
# 4. BASE DE DATOS FALLBACK (SQLite / Development)
# -------------------------------------------------------
# Desarrollo local o testing.
SQLITE_URL=sqlite+aiosqlite:///./data/theaia.db
SQLITE_CHECK_SAME_THREAD=false        # Necesario para aiosqlite


# -------------------------------------------------------
# 5. CORE THEA IA Y FSM
# -------------------------------------------------------
# Hito H01-H03: Núcleo, FSM y máquina de estados.
THEA_CORE_ENABLED=true
THEA_ROUTER_CLASS=TheaRouter          # Alias CoreRouter
THEA_SESSION_MANAGER_ENABLED=true
FSM_ENABLED=true
FSM_TIMEOUT_SECONDS=300
FSM_LOG_TRANSITIONS=true
CONTEXT_MANAGER_CLASS=SessionManager
CONTEXT_PERSISTENCE_TYPE=database     # database o redis
CONTEXT_TTL_SECONDS=86400             # 1 día por defecto


# -------------------------------------------------------
# 6. AGENTES ESPECIALIZADOS
# -------------------------------------------------------
# Hito H05: Agentes verticales (agenda, notas, eventos, etc).
AGENTS_ENABLED=true
AGENT_AGENDA_ENABLED=true
AGENT_NOTE_ENABLED=true
AGENT_EVENT_ENABLED=true
AGENT_QUERY_ENABLED=true
AGENT_REMINDER_ENABLED=true
AGENT_SCHEDULER_ENABLED=true
AGENT_HELP_ENABLED=true
AGENT_FALLBACK_ENABLED=true
AGENT_TIMEOUT_SECONDS=60


# -------------------------------------------------------
# 7. MACHINE LEARNING E INTENT DETECTION
# -------------------------------------------------------
# Hito H06: Pipelines de intent ML y extracción de entidades.
ML_ENABLED=true
INTENT_DETECTOR_CLASS=IntentDetector
INTENT_DETECTOR_MODEL=default         # default, advanced, custom
INTENT_CONFIDENCE_THRESHOLD=0.82      # Umbral confianza (0-1)
INTENT_MODEL_PATH=./models/intent_classifier_v3.pkl
ENTITY_EXTRACTOR_ENABLED=true
ENTITY_CONFIDENCE_THRESHOLD=0.75      # Umbral entidades
ENTITY_MODEL_PATH=./models/entity_extractor_v3.pkl
SPACY_MODEL=es_core_news_md           # Modelo spacy para NLP español
ML_BATCH_SIZE=32
ML_CACHE_ENABLED=true


# -------------------------------------------------------
# 8. ADAPTADORES MULTI-CANAL
# -------------------------------------------------------
# Hito H02: Adapter Telegram/Web.
# Hito H10: Adaptadores WhatsApp, API REST y futuros.
ADAPTERS_ENABLED=true
ENABLED_ADAPTERS=telegram,rest        # Separadas por coma

# Telegram (H02)
TELEGRAM_BOT_TOKEN=your_bot_token_here
TELEGRAM_WEBHOOK_URL=https://api.theaia.com/webhook/telegram
TELEGRAM_WEBHOOK_SECRET=replace_with_webhook_secret
TELEGRAM_POLLING=false                # true: polling, false: webhook
TELEGRAM_TIMEOUT_SECONDS=30

# WhatsApp (H10)
WHATSAPP_ADAPTER_ENABLED=false
WHATSAPP_API_KEY=your_whatsapp_api_key_here
WHATSAPP_PHONE_NUMBER=+1234567890
WHATSAPP_WEBHOOK_URL=https://api.theaia.com/webhook/whatsapp

# REST API (General)
REST_API_ENABLED=true
REST_API_VERSION=v1


# -------------------------------------------------------
# 9. CACHE Y MENSAJERÍA (Redis / Celery)
# -------------------------------------------------------
# Hito H03-H04: Performance, escalabilidad y orquestación.
CACHE_ENABLED=true
CACHE_BACKEND=redis                   # redis o memory
CACHE_TTL_SECONDS=3600
REDIS_HOST=redis.theaia.internal
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=0
REDIS_URI=redis://redis.theaia.internal:6379/0
REDIS_POOL_SIZE=10

# Celery para tareas asincrónicas
CELERY_ENABLED=false                  # Activar si usas tareas async
CELERY_BROKER_URL=redis://redis.theaia.internal:6379/1
CELERY_RESULT_BACKEND=redis://redis.theaia.internal:6379/2


# -------------------------------------------------------
# 10. LOGGING Y AUDITORÍA
# -------------------------------------------------------
# Hito H07-H11: E2E tests, observabilidad y logging avanzado.
LOG_FILE_PATH=./logs/theaia.log
LOG_MAX_SIZE_MB=20
LOG_BACKUP_COUNT=7
LOG_JSON_FORMAT=true
AUDIT_ENABLED=true
AUDIT_LOG_PATH=./logs/audit.log
AUDIT_RETENTION_DAYS=90
AUDIT_INCLUDE_PAYLOAD=false           # Cuidado privacidad en prod


# -------------------------------------------------------
# 11. MÉTRICAS Y OBSERVABILIDAD
# -------------------------------------------------------
# Hito H11: Observabilidad, logging y panel de métricas.
METRICS_ENABLED=true
PROMETHEUS_ENABLED=false              # Activar en producción
PROMETHEUS_PORT=9090
PROMETHEUS_ENDPOINT=/metrics
HEALTHCHECK_ENDPOINT=/health
HEALTH_CHECK_INTERVAL=30
SENTRY_ENABLED=false                  # Error tracking opcional
SENTRY_DSN=your_sentry_dsn_here


# -------------------------------------------------------
# 12. GRAFANA, PROMETHEUS Y LOKI (STACK ELK)
# -------------------------------------------------------
# Monitoreo empresarial (H11).
GRAFANA_ENABLED=false
GRAFANA_DASHBOARD_URL=https://grafana.theaia.com
PROMETHEUS_TARGET_URL=http://prometheus.theaia.internal:9090
LOKI_LOG_SERVER=http://loki.theaia.internal:3100
ENABLE_ALERTS=false


# -------------------------------------------------------
# 13. AUTENTICACIÓN, SEGURIDAD Y CORS
# -------------------------------------------------------
# Hito H13: Seguridad, gestión de secretos y hardening.
CORS_ENABLED=true
CORS_ALLOWED_ORIGINS=https://app.theaia.com,https://admin.theaia.com
ALLOWED_HOSTS=localhost,127.0.0.1,app.theaia.com
CSRF_PROTECTION=true
CSRF_TRUSTED_ORIGINS=https://app.theaia.com
RATE_LIMIT_ENABLED=true
RATE_LIMIT_REQUESTS_PER_MINUTE=100
RATE_LIMIT_REQUESTS_PER_HOUR=1000

# Encriptación y secretos
ENCRYPTION_ENABLED=true
ENCRYPTION_ALGORITHM=AES-256
ENCRYPTION_KEY=your_encryption_key_here_32_chars_minimum
SECRET_BACKUP_KEY=your_backup_encryption_key_here


# -------------------------------------------------------
# 14. MULTI-EMPRESA Y ROLES (H08)
# -------------------------------------------------------
# Hito H08: Arquitectura multi-empresa y control de roles.
MULTI_TENANT_ENABLED=false            # false ahora, true en futuro
ROLE_BASED_ACCESS_ENABLED=true        # RBAC: admin, user, auditor
DEFAULT_ROLE=user
SUPER_ADMIN_EMAIL=admin@theaia.com


# -------------------------------------------------------
# 15. BACKUPS Y RECUPERACIÓN ANTE DESASTRES
# -------------------------------------------------------
# Hito H04-H09: Persistencia, backups y alta disponibilidad.
BACKUP_ENABLED=true
BACKUP_PATH=/var/backups/theaia/
BACKUP_CRON=0 2 * * *                 # 2 AM todos los días
BACKUP_RETENTION_DAYS=30
BACKUP_COMPRESSION=true
BACKUP_ENCRYPTION_ENABLED=true


# -------------------------------------------------------
# 16. CI/CD Y DESPLIEGUE
# -------------------------------------------------------
# Hito H09: Dockerización, despliegue cloud/K8s y CI/CD auditado.
DEPLOYMENT_ENVIRONMENT=production     # development, staging, production
DOCKER_ENABLED=true
DOCKER_REGISTRY=registry.theaia.com
IMAGE_NAME=thea-ia
IMAGE_TAG=latest
DOCKERFILE_PATH=./Dockerfile
DOCKER_BUILD_ARGS=--build-arg BUILDKIT_INLINE_CACHE=1

# Kubernetes / Orchestración
K8S_ENABLED=false
K8S_NAMESPACE=theaia
K8S_CONFIG_PATH=/root/.kube/config


# -------------------------------------------------------
# 17. EMAIL Y NOTIFICACIONES
# -------------------------------------------------------
# Notificaciones corporativas y alertas.
SMTP_ENABLED=true
SMTP_SERVER=smtp.theaia.com
SMTP_PORT=587
SMTP_USE_TLS=true
SMTP_USER=notifications@theaia.com
SMTP_PASSWORD=secure_password_here
SYSTEM_EMAIL=system@theaia.com
ADMIN_EMAIL=admin@theaia.com
NOTIFICATION_EMAIL_ENABLED=true


# -------------------------------------------------------
# 18. TESTING Y COVERAGE
# -------------------------------------------------------
# Hito H07: E2E tests y coverage automatizado.
TESTING_MODE=false
TEST_DATABASE_URL=sqlite:///./test.db
TEST_DATABASE_ECHO=false
COVERAGE_ENABLED=false
PYTEST_CACHING=true


# -------------------------------------------------------
# 19. FEATURE FLAGS Y CONFIGURACIÓN AVANZADA
# -------------------------------------------------------
# Para activar/desactivar features sin redeploy.
FEATURE_FLAGS=feat_new_agents,feat_advanced_fsm,feat_multi_tenant_ready
CUSTOM_CONFIG_PATH=./config/custom.yaml
EXPERIMENTAL_FEATURES_ENABLED=false


# -------------------------------------------------------
# 20. VARIABLES INTERNAS Y COMPATIBILIDAD
# -------------------------------------------------------
# Uso interno, no modificar sin conocimiento previo.
PYTHONUNBUFFERED=1                    # Output buffering
PYTHONDONTWRITEBYTECODE=1             # No generar .pyc
ENVIRONMENT_FILE_VERSION=2.0
LAST_UPDATED=2025-10-31
MAINTAINER=Alvaro_Fernandez_Mota_CEO


# =======================================================
# AVISOS IMPORTANTES DE SEGURIDAD Y AUDITORÍA
# =======================================================
#
# 1. NUNCA subas .env al repositorio → Protegido en .gitignore
# 2. Reemplaza TODOS los valores "your_*_here" con valores reales
# 3. En producción: usa secretos de AWS Secrets Manager, Azure KeyVault, etc.
# 4. Rotación de secretos cada 90 días (auditoría recomendada)
# 5. Cada nuevo hito puede requerir nuevas variables → Actualiza esta plantilla
# 6. Documen cambios en CHANGELOG.md cuando actualices variables
# 7. Usa valores diferentes por entorno (dev ≠ staging ≠ production)
# 8. Auditoría: revisa logs de acceso a secretos regularmente
#
# =======================================================
